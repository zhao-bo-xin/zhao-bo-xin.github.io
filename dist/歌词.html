<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <audio
            controls
            src="https://music.163.com/song/media/outer/url?id=1833633769.mp3"
        ></audio>
        <script>
            var lyric =
                "[00:00.000] 作词 : G.E.M.邓紫棋\n[00:01.000] 作曲 : G.E.M.邓紫棋\n[00:09.262]还没完全离去\n[00:11.028]也许  是在等个结局\n[00:12.942]Yeah 但故事再延续\n[00:14.741]你演了场 滑稽的喜剧\n[00:17.637]要忘掉一个人\n[00:19.271]也许  心里要带点怨恨\n[00:21.384]例如发现你  没多单纯\n[00:23.838]我却有多愚蠢\n[00:25.796]这会不会是你唯一的谎言\n[00:29.976]不可能  不可能\n[00:33.890]这只不过是我第一次发现\n[00:38.134]你的谎  有多漂亮\n[00:42.463]你是否有超能力\n[00:45.185]说谎才能全部都不留痕迹  不可思议\n[00:50.879]原来你的超能力\n[00:53.793]瞬间能够崩塌我所有回忆  我讨厌你\n[01:00.087]Biu Biu Biu Biu Biu Biu Biu\n[01:02.326]噢我好想代替月亮消灭你  我讨厌你\n[01:08.569]Biu Biu Biu Biu Biu Biu Biu\n[01:10.783]噢你的伪装实在无人能及  天下无敌\n[01:17.095]Shhhhhh  关闭嘴巴\n[01:19.191]就让假亦真时真亦假\n[01:21.888]你的笑话  我无法消化\n[01:25.198]Badaboom  原地爆炸\n[01:27.629]你炸到我心碎成了烟花\n[01:30.738]（My God）那让我苦中作乐吧\n[01:33.800]这会不会是你唯一的谎言\n[01:37.796]不可能  不可能\n[01:41.825]这只不过是我第一次发现\n[01:46.138]你的谎  有多漂亮\n[01:50.301]你是否有超能力\n[01:53.114]说谎才能 全部都不留痕迹  不可思议\n[01:58.742]原来你的超能力\n[02:01.590]瞬间能够崩塌我所有回忆  我讨厌你\n[02:08.182]Biu Biu Biu Biu Biu Biu Biu\n[02:09.997]噢我好想代替月亮消灭你  我讨厌你\n[02:16.532]Biu Biu Biu Biu Biu Biu Biu\n[02:18.740]噢你的伪装实在无人能及  天下无敌\n[02:26.201]我从未想过有一天\n[02:30.364]会感觉不认识你\n[02:34.477]你神奇得就像世界第八个奇迹\n[02:44.101]超能力\n[02:46.199]说谎才能 全部都不留痕迹  不可思议\n[02:51.925]原来你的超能力\n[02:54.723]瞬间能够崩塌我所有回忆  我讨厌你\n[03:01.167]Biu Biu Biu Biu Biu Biu Biu\n[03:05.359]超能力  超能力\n[03:09.653]Biu Biu Biu Biu Biu Biu Biu\n[03:13.800]超能力  超能力\n";

            var tmp = lyric.split(/\n/gim);
            // // var xxx = tmp.map(e=>{
            // //     return {

            // //     }
            // // })

            // var str = "[02:34.477]你神奇得就像世界第八个奇迹";
            // // var n = str.match(/\[\d{2,3}\.\d{2}\.\d{2,3}\]/gim);
            // // var n = str.match(/\d{2,3}/gim);
            // // var n = str.match(/^\[\d{2,3}\:\d{2}\.\d{2,3}\]/);
            // // var m = str.match(/[^(^\[\d{2,3}\:\d{2}\.\d{2,3}\])]/gim);

            // var x = str.split(/\]/);
            // var m = x[0].replace("[", "").split(":");
            // var n = x[1];
            // var t = m[0] * 60 + m[1] * 1;

            function parseLyric(lyric) {
                return lyric
                    .split(/\n/gim)
                    .filter((e) => e)
                    .map((e) => {
                        var x = e.split(/\]/);
                        var m = x[0].replace("[", "").split(":");

                        return {
                            time: (m[0] * 60 + m[1] * 1).toFixed(3),
                            text: x[1],
                        };
                    });
            }

            var parsedLyric = parseLyric(lyric);

            function findCurrentLyricIndex(currentTime, parsedLyric) {
                var index = parsedLyric.findIndex((e) => e.time > currentTime);

                return index == -1 ? parsedLyric.length - 1 : index - 1;
            }

            document.querySelector("audio").ontimeupdate = function() {
                // console.log(this.currentTime);
                console.log(
                    findCurrentLyricIndex(this.currentTime, parsedLyric)
                );
            };
        </script>
    </body>
</html>
